name: ğŸ¯ GitHub Issues Notifier
on:
  issues:
    types: [opened, closed, reopened, labeled, unlabeled, assigned, unassigned]

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“Š Prepare Notification Data
        id: prepare
        run: |
          # Set emoji based on action
          case "${{ github.event.action }}" in
            "opened") EMOJI="ğŸ“‚" ;;
            "closed") EMOJI="âœ…" ;;
            "reopened") EMOJI="ğŸ”„" ;;
            "labeled") EMOJI="ğŸ·ï¸" ;;
            "unlabeled") EMOJI="ğŸ·ï¸âŒ" ;;
            "assigned") EMOJI="ğŸ‘¤" ;;
            "unassigned") EMOJI="ğŸ‘¥" ;;
            *) EMOJI="ğŸ“‹" ;;
          esac
          
          # Set color
          if [ "${{ github.event.action }}" = "opened" ]; then
            COLOR="65280"  # Green
          elif [ "${{ github.event.action }}" = "closed" ]; then
            COLOR="15158332"  # Red
          else
            COLOR="3447003"  # Blue
          fi
          
          echo "emoji=$EMOJI" >> $GITHUB_OUTPUT
          echo "color=$COLOR" >> $GITHUB_OUTPUT
          
          # Format labels
          LABELS="${{ join(github.event.issue.labels.*.name, ', ') }}"
          if [ -z "$LABELS" ]; then
            echo "labels_formatted=No labels" >> $GITHUB_OUTPUT
          else
            echo "labels_formatted=$LABELS" >> $GITHUB_OUTPUT
          fi
          
          # Format assignees
          ASSIGNEES="${{ join(github.event.issue.assignees.*.login, ', ') }}"
          if [ -z "$ASSIGNEES" ]; then
            echo "assignees_formatted=Unassigned" >> $GITHUB_OUTPUT
          else
            echo "assignees_formatted=$ASSIGNEES" >> $GITHUB_OUTPUT
          fi

      - name: ğŸ“¨ Send to Discord
        uses: appleboy/discord-action@0.0.3
        with:
          webhook_id: ${{ secrets.DISCORD_WEBHOOK_ID }}
          webhook_token: ${{ secrets.DISCORD_WEBHOOK_TOKEN }}
          username: "GitHub Issues"
          avatar_url: "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
          embeds: |
            [
              {
                "title": "${{ steps.prepare.outputs.emoji }} Issue #${{ github.event.issue.number }}: ${{ github.event.issue.title }}",
                "description": "**Repository:** `${{ github.repository }}`\n**Action:** `${{ github.event.action }}`",
                "url": "${{ github.event.issue.html_url }}",
                "color": ${{ steps.prepare.outputs.color }},
                "fields": [
                  {
                    "name": "ğŸ‘¤ Author",
                    "value": "${{ github.event.issue.user.login }}",
                    "inline": true
                  },
                  {
                    "name": "ğŸ“Š State",
                    "value": "${{ github.event.issue.state }}",
                    "inline": true
                  },
                  {
                    "name": "ğŸ·ï¸ Labels",
                    "value": "${{ steps.prepare.outputs.labels_formatted }}",
                    "inline": true
                  },
                  {
                    "name": "ğŸ‘¥ Assignees",
                    "value": "${{ steps.prepare.outputs.assignees_formatted }}",
                    "inline": true
                  },
                  {
                    "name": "ğŸ’¬ Comments",
                    "value": "${{ github.event.issue.comments }}",
                    "inline": true
                  }
                ],
                "footer": {
                  "text": "GitHub Issues â€¢ ${{ github.event.action }}"
                },
                "timestamp": "${{ github.event.issue.updated_at }}"
              }
            ]
